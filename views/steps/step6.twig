{% if not embedded %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cutting Data – Paso&nbsp;6</title>
  {{ stylesHtml|raw }}
  <script>
    window.BASE_URL  = {{ BASE_URL|json_encode|raw }};
    window.BASE_HOST = {{ BASE_HOST|json_encode|raw }};
  </script>
</head>
<body>
{% endif %}

{% if assetErrors %}
  <div class="alert alert-warning text-dark m-3">
    <strong>⚠️ Archivos faltantes (se usarán CDNs):</strong>
    <ul>
      {% for err in assetErrors %}
        <li>{{ err }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

<div class="step6">
<div class="content-main">
  <div class="container py-4">
    <h2 class="step-title"><i data-feather="bar-chart-2"></i> Resultados</h2>
    <p class="step-desc">Ajustá los parámetros y revisá los datos de corte.</p>
  <!-- BLOQUE CENTRAL -->
  <div class="row gx-3 mb-4 cards-grid">
    <div class="col-12 col-lg-4 mb-3 area-tool">
      <div class="card h-100 shadow-sm">
        <div class="card-header text-center p-3">
          <span>#{{ serialNumber }} – {{ toolCode }}</span>
        </div>
        <div class="card-body text-center p-4">
          {% if imageURL %}
            <img src="{{ imageURL }}" alt="Imagen principal herramienta" class="tool-image mx-auto d-block">
          {% else %}
            <div class="text-secondary">Sin imagen disponible</div>
          {% endif %}
          <div class="tool-name mt-3">{{ toolName }}</div>
          <div class="tool-type">{{ toolType }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- AJUSTES / RESULTADOS / RADAR -->
  <div class="row gx-3 mb-4 cards-grid">
    <!-- Ajustes -->
    <div class="col-12 col-lg-4 mb-3 area-sliders">
      <div class="card h-100 shadow-sm">
        <div class="card-header text-center p-3"><h5 class="mb-0">Ajustes</h5></div>
        <div class="card-body p-4">
          <!-- fz -->
          <div class="mb-4 px-2">
            <label for="sliderFz" class="form-label">fz (mm/tooth)</label>
            <div class="slider-wrap">
              <input type="range" id="sliderFz" class="form-range"
                     min="{{ fzMinDb }}"
                     max="{{ fzMaxDb }}"
                     step="0.0001"
                     value="{{ baseFz }}">
              <span class="slider-bubble"></span>
            </div>
            <div class="text-end small text-secondary mt-1">
              <span>{{ fzMinDb }}</span> –
              <strong id="valFz">{{ baseFz }}</strong> –
              <span>{{ fzMaxDb }}</span>
            </div>
          </div>
          <!-- Vc -->
          <div class="mb-4 px-2">
            <label for="sliderVc" class="form-label">Vc (m/min)</label>
            <div class="slider-wrap">
              <input type="range" id="sliderVc" class="form-range"
                     min="{{ vcMinDb }}"
                     max="{{ vcMaxDb }}"
                     step="0.1"
                     value="{{ baseVc }}">
              <span class="slider-bubble"></span>
            </div>
            <div class="text-end small text-secondary mt-1">
              <span>{{ vcMinDb }}</span> –
              <strong id="valVc">{{ baseVc }}</strong> –
              <span>{{ vcMaxDb }}</span>
            </div>
          </div>
          <!-- ae -->
          <div class="mb-4 px-2">
            <label for="sliderAe" class="form-label">
              ae (mm) <small>(ancho de pasada)</small>
            </label>
            <div class="slider-wrap">
              <input type="range" id="sliderAe" class="form-range"
                     min="0.1"
                     max="{{ diameterMb }}"
                     step="0.1"
                     value="{{ aeDefault }}">
              <span class="slider-bubble"></span>
            </div>
            <div class="text-end small text-secondary mt-1">
              <span>0.1</span> –
              <strong id="valAe">{{ aeDefault }}</strong> –
              <span>{{ diameterMb }}</span>
            </div>
          </div>
          <!-- Pasadas -->
          <div class="mb-4 px-2">
            <label for="sliderPasadas" class="form-label">Pasadas</label>
            <div class="slider-wrap">
              <input type="range" id="sliderPasadas" class="form-range"
                     min="1" max="1" step="1"
                     value="1"
                     data-thickness="{{ thickness }}">
              <span class="slider-bubble"></span>
            </div>
            <div id="textPasadasInfo" class="small text-secondary mt-1">
              1 pasada de {{ thickness }} mm
            </div>
            <div id="errorMsg" class="text-danger mt-2 small"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <div class="col-12 col-lg-4 mb-3 area-results">
      <div class="card h-100 shadow-sm">
        <div class="card-header text-center p-3"><h5 class="mb-0">Resultados</h5></div>
        <div class="card-body p-4">
          <div class="results-compact mb-4 d-flex gap-2">
            <div class="result-box text-center flex-fill">
              <div class="param-label">
                Feedrate<br><small>(<span class="param-unit">mm/min</span>)</small>
              </div>
              <div id="outVf" class="fw-bold display-6">{{ outVf }}</div>
            </div>
            <div class="result-box text-center flex-fill">
              <div class="param-label">
                Cutting speed<br><small>(<span class="param-unit">RPM</span>)</small>
              </div>
              <div id="outN" class="fw-bold display-6">{{ outN }}</div>
            </div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <small>Vc</small>
            <div><span id="outVc" class="fw-bold">{{ outVc }}</span> <span class="param-unit">m/min</span></div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <small>fz</small>
            <div><span id="outFz" class="fw-bold">--</span> <span class="param-unit">mm/tooth</span></div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <small>Ap</small>
            <div><span id="outAp" class="fw-bold">--</span> <span class="param-unit">mm</span></div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <small>Ae</small>
            <div><span id="outAe" class="fw-bold">--</span> <span class="param-unit">mm</span></div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <small>hm</small>
            <div><span id="outHm" class="fw-bold">--</span> <span class="param-unit">mm</span></div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <small>Hp</small>
            <div><span id="outHp" class="fw-bold">--</span> <span class="param-unit">HP</span></div>
          </div>
          <!-- Métricas secundarias -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="param-label">
              MMR<br><small>(<span class="param-unit">mm³/min</span>)</small>
            </div>
            <div id="valueMrr" class="fw-bold">--</div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="param-label">
              Fc<br><small>(<span class="param-unit">N</span>)</small>
            </div>
            <div id="valueFc" class="fw-bold">--</div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="param-label">
              Potencia<br><small>(<span class="param-unit">W</span>)</small>
            </div>
            <div id="valueW" class="fw-bold">--</div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="param-label">
              η<br><small>(<span class="param-unit">%</span>)</small>
            </div>
            <div id="valueEta" class="fw-bold">--</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Radar Chart -->
    <div class="col-12 col-lg-4 mb-3 area-radar">
      <div class="card h-100 shadow-sm">
        <div class="card-header text-center p-3"><h5 class="mb-0">Distribución Radar</h5></div>
        <div class="card-body p-4 d-flex justify-content-center align-items-center">
          <canvas id="radarChart" width="300" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- ESPECIFICACIONES / CONFIGURACIÓN / NOTAS -->
  <div class="row gx-3 mb-4 cards-grid">
    <!-- Especificaciones -->
    <div class="col-12 col-lg-4 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-header text-center p-3" data-bs-toggle="collapse" data-bs-target="#specCollapse" aria-expanded="true">
          <h5 class="mb-0">Especificaciones Técnicas</h5>
        </div>
        <div id="specCollapse" class="collapse show">
          <div class="card-body p-4">
            <div class="row gx-0 align-items-center">
              <div class="col-12 col-lg-7 px-2 mb-4 mb-lg-0">
                <ul class="spec-list mb-0 px-2">
                  <li><span>Diámetro de corte (d1):</span>
                      <span>{{ diameterMb|number_format(3, '.', '') }}<span class="param-unit">mm</span></span>
                  </li>
                  <li><span>Diámetro del vástago:</span>
                      <span>{{ shankMb|number_format(3, '.', '') }}<span class="param-unit">mm</span></span>
                  </li>
                  <li><span>Longitud de corte:</span>
                      <span>{{ cutLenMb|number_format(3, '.', '') }}<span class="param-unit">mm</span></span>
                  </li>
                  <li><span>Longitud de filo:</span>
                      <span>{{ fluteLenMb|number_format(3, '.', '') }}<span class="param-unit">mm</span></span>
                  </li>
                  <li><span>Longitud total:</span>
                      <span>{{ fullLenMb|number_format(3, '.', '') }}<span class="param-unit">mm</span></span>
                  </li>
                  <li><span>Número de filos (Z):</span><span>{{ fluteCountMb }}</span></li>
                  <li><span>Tipo de punta:</span><span>{{ toolType }}</span></li>
                  <li><span>Recubrimiento:</span><span>{{ coatingMb }}</span></li>
                  <li><span>Material fabricación:</span><span>{{ materialMb }}</span></li>
                  <li><span>Marca:</span><span>{{ brandMb }}</span></li>
                  <li><span>País de origen:</span><span>{{ madeInMb }}</span></li>
                </ul>
              </div>
              <div class="col-12 col-lg-5 px-2 d-flex justify-content-center align-items-center">
                {% if vectorURL %}
                  <img src="{{ vectorURL }}" alt="Imagen vectorial herramienta" class="vector-image mx-auto d-block">
                {% else %}
                  <div class="text-secondary">Sin imagen vectorial</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Configuración -->
    <div class="col-12 col-lg-4 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-header text-center p-3" data-bs-toggle="collapse" data-bs-target="#configCollapse" aria-expanded="true">
          <h5 class="mb-0">Configuración de Usuario</h5>
        </div>
        <div id="configCollapse" class="collapse show">
          <div class="card-body p-4">
            <div class="config-section mb-3">
              <div class="config-section-title">Material</div>
              <div class="config-item">
                <div class="label-static">Categoría padre:</div>
                <div class="value-static">{{ materialParent }}</div>
              </div>
              <div class="config-item">
                <div class="label-static">Material a mecanizar:</div>
                <div class="value-static">{{ materialName }}</div>
              </div>
            </div>
            <div class="section-divider"></div>
            <div class="config-section mb-3">
              <div class="config-section-title">Estrategia</div>
              <div class="config-item">
                <div class="label-static">Categoría padre estr.:</div>
                <div class="value-static">{{ strategyParent }}</div>
              </div>
              <div class="config-item">
                <div class="label-static">Estrategia de corte:</div>
                <div class="value-static">{{ strategyName }}</div>
              </div>
            </div>
            <div class="section-divider"></div>
            <div class="config-section">
              <div class="config-section-title">Máquina</div>
              <div class="config-item">
                <div class="label-static">Espesor del material:</div>
                <div class="value-static">{{ thickness }} <span class="param-unit">mm</span></div>
              </div>
              <div class="config-item">
                <div class="label-static">Tipo de transmisión:</div>
                <div class="value-static">{{ transName }}</div>
              </div>
              <div class="config-item">
                <div class="label-static">Feedrate máximo:</div>
                <div class="value-static">{{ frMax|number_format }} <span class="param-unit">mm/min</span></div>
              </div>
              <div class="config-item">
                <div class="label-static">RPM mínima:</div>
                <div class="value-static">{{ rpmMin|number_format }} <span class="param-unit">rev/min</span></div>
              </div>
              <div class="config-item">
                <div class="label-static">RPM máxima:</div>
                <div class="value-static">{{ rpmMax|number_format }} <span class="param-unit">rev/min</span></div>
              </div>
              <div class="config-item">
                <div class="label-static">Potencia disponible:</div>
                <div class="value-static">{{ powerAvail|number_format(1,'.','') }} <span class="param-unit">HP</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notas -->
    <div class="col-12 col-lg-4 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-header text-center p-3"><h5 class="mb-0">Notas Adicionales</h5></div>
        <div class="card-body p-4">
          {% if notesArray %}
            <ul class="notes-list mb-0">
              {% for note in notesArray %}
                <li class="mb-2 d-flex align-items-start">
                  <i data-feather="file-text" class="me-2"></i>
                  <div>{{ note }}</div>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="text-secondary">No hay notas adicionales para esta herramienta.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
</div><!-- .content-main -->
</div><!-- .step6 -->
<section id="wizard-dashboard"></section>

<!-- SCRIPTS -->
<script>window.step6Params = {{ jsonParams|raw }}; window.step6Csrf = '{{ csrfToken }}';</script>
{% if not embedded %}
<script src="{{ bootstrapJsRel }}" defer></script>
<script src="{{ featherJs }}" defer></script>
<script src="{{ chartJs }}" defer></script>
<script src="{{ countUpJs }}" defer></script>
<script src="{{ step6JsRel }}" defer></script>
<script>requestAnimationFrame(() => feather.replace());</script>
</body>
</html>
{% endif %}
